<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äººæ‰åº“ - Grassroots Project</title>
  <style>
    :root {
      --primary-color: #1a1a1a;
      --accent-color: #f7931a;
      --bg-color: #ffffff;
      --text-color: #333333;
      --light-gray: #f5f5f5;
      --border-color: #e0e0e0;
      --nav-bg: rgba(255, 255, 255, 0.95);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: var(--text-color);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--nav-bg);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-color);
      padding: 0.8rem 2rem;
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    nav .logo {
      font-size: 1.4rem;
      font-weight: bold;
      color: var(--primary-color);
      text-decoration: none;
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 2rem;
    }

    nav a {
      text-decoration: none;
      color: var(--text-color);
      transition: all 0.3s;
      font-size: 0.95rem;
    }

    nav a:hover, nav a.active {
      color: var(--accent-color);
      font-weight: 500;
    }

    .hamburger {
      display: none;
      flex-direction: column;
      gap: 5px;
      cursor: pointer;
      padding: 5px;
    }

    .hamburger span {
      width: 25px;
      height: 2px;
      background: var(--primary-color);
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 100px 1.5rem 40px;
    }

    h1 {
      text-align: center;
      color: white;
      font-size: 2.2rem;
      margin-bottom: 30px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    /* ç»Ÿè®¡å¡ç‰‡ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .stat-card .number {
      font-size: 2rem;
      font-weight: bold;
      color: var(--primary-color);
    }

    .stat-card .label {
      font-size: 0.9rem;
      color: #666;
      margin-top: 5px;
    }

    .stat-card.highlight .number {
      color: var(--accent-color);
    }

    /* ä¸»å†…å®¹åŒº */
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: 20px;
    }

    .pool-card {
      background: rgba(255, 255, 255, 0.95);
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    }

    .pool-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--border-color);
    }

    .pool-header h2 {
      color: var(--primary-color);
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .edit-link {
      padding: 6px 12px;
      background: var(--accent-color);
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-size: 0.85rem;
      transition: all 0.3s;
    }

    .edit-link:hover {
      background: #e8830f;
    }

    /* æˆå‘˜å¡ç‰‡ */
    .member-grid {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .member-card {
      background: var(--light-gray);
      padding: 18px;
      border-radius: 12px;
      border-left: 4px solid var(--accent-color);
      transition: all 0.3s;
    }

    .member-card:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .member-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .member-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .member-info h3 {
      font-size: 1.1rem;
      color: var(--primary-color);
      margin: 0;
    }

    .member-info .join-date {
      font-size: 0.85rem;
      color: #666;
    }

    .member-tasks {
      margin-top: 10px;
    }

    .task-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8rem;
      margin: 3px 3px 3px 0;
      text-decoration: none;
      transition: all 0.3s;
    }

    .task-badge.in-progress {
      background: #dbeafe;
      color: #1e40af;
    }

    .task-badge.completed {
      background: #dcfce7;
      color: #166534;
    }

    .task-badge:hover {
      transform: translateY(-2px);
    }

    .member-skills {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 10px;
    }

    .skill-tag {
      padding: 3px 8px;
      background: #e0e0e0;
      border-radius: 10px;
      font-size: 0.75rem;
      color: #666;
    }

    /* æ´»åŠ¨æµ */
    .activity-feed {
      max-height: 600px;
      overflow-y: auto;
    }

    .activity-item {
      padding: 12px 0;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      gap: 12px;
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      flex-shrink: 0;
    }

    .activity-icon.claim { background: #dbeafe; }
    .activity-icon.complete { background: #dcfce7; }
    .activity-icon.create { background: #fef3c7; }

    .activity-content {
      flex: 1;
    }

    .activity-content .actor {
      font-weight: 600;
      color: var(--primary-color);
    }

    .activity-content .task-link {
      color: var(--accent-color);
      text-decoration: none;
    }

    .activity-content .task-link:hover {
      text-decoration: underline;
    }

    .activity-time {
      font-size: 0.8rem;
      color: #999;
      margin-top: 4px;
    }

    .no-activity {
      text-align: center;
      padding: 30px;
      color: #666;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .refresh-btn {
      padding: 6px 12px;
      background: none;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.3s;
    }

    .refresh-btn:hover {
      background: var(--light-gray);
    }

    footer {
      text-align: center;
      padding: 2rem;
      color: rgba(255, 255, 255, 0.8);
    }

    footer a { color: white; }

    .back-to-top {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 45px;
      height: 45px;
      background: white;
      color: #667eea;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      transition: all 0.3s;
      z-index: 100;
    }

    .back-to-top:hover {
      transform: translateY(-2px);
    }

    .back-to-top.hidden { display: none; }

    @media (max-width: 900px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      nav { padding: 0.8rem 1rem; }
      nav .logo { font-size: 1.2rem; }
      .hamburger { display: flex; }
      nav ul {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--nav-bg);
        flex-direction: column;
        padding: 1rem;
        gap: 0;
      }
      nav ul.show { display: flex; }
      nav ul li { width: 100%; }
      nav ul li a { padding: 0.8rem 1rem; display: block; }
      h1 { font-size: 1.6rem; }
      .container { padding: 100px 1rem 40px; }
      .pool-card { padding: 18px; }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <nav>
    <a href="../index.html" class="logo">ğŸŒ± Grassroots Project</a>
    <div class="hamburger" onclick="toggleMenu()">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <ul id="nav-menu">
      <li><a href="../index.html">ğŸ  é¦–é¡µ</a></li>
      <li><a href="about.html">ğŸ’¡ å…³äº</a></li>
      <li><a href="tasks.html">ğŸ“‹ ä»»åŠ¡æ± </a></li>
      <li><a href="kanban.html">ğŸ“Š çœ‹æ¿</a></li>
      <li><a href="people.html" class="active">ğŸ‘¥ äººæ‰åº“</a></li>
      <li><a href="resources.html">ğŸ“¦ èµ„æºæ± </a></li>
      <li><a href="assistant.html">ğŸ¤– AI åŠ©æ‰‹</a></li>
      <li><a href="join.html">ğŸš€ åŠ å…¥æˆ‘ä»¬</a></li>
    </ul>
  </nav>

  <div class="container">
    <h1>ğŸ‘¥ äººæ‰åº“</h1>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-grid" id="stats-grid">
      <div class="stat-card">
        <div class="number" id="stat-members">-</div>
        <div class="label">æˆå‘˜</div>
      </div>
      <div class="stat-card highlight">
        <div class="number" id="stat-in-progress">-</div>
        <div class="label">è¿›è¡Œä¸­</div>
      </div>
      <div class="stat-card">
        <div class="number" id="stat-completed">-</div>
        <div class="label">å·²å®Œæˆ</div>
      </div>
      <div class="stat-card">
        <div class="number" id="stat-open">-</div>
        <div class="label">å¾…é¢†å–</div>
      </div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-grid">
      <!-- æˆå‘˜åˆ—è¡¨ -->
      <div class="pool-card">
        <div class="pool-header">
          <h2>ğŸ‘¥ æˆå‘˜ä»»åŠ¡</h2>
          <button class="refresh-btn" onclick="loadAll()">ğŸ”„ åˆ·æ–°</button>
        </div>
        <div id="member-list" class="member-grid">
          <div class="loading">åŠ è½½ä¸­...</div>
        </div>
      </div>

      <!-- æ´»åŠ¨æµ -->
      <div class="pool-card">
        <div class="pool-header">
          <h2>ğŸ“¢ æœ€è¿‘åŠ¨æ€</h2>
          <a href="https://github.com/grassroots-project/tasks/issues" target="_blank" class="edit-link">æŸ¥çœ‹å…¨éƒ¨</a>
        </div>
        <div id="activity-feed" class="activity-feed">
          <div class="loading">åŠ è½½ä¸­...</div>
        </div>
      </div>
    </div>
  </div>

  <button class="back-to-top hidden" onclick="scrollToTop()" title="è¿”å›é¡¶éƒ¨">â†‘</button>

  <footer>
    <p>Â© 2026 Grassroots Project Â· <a href="https://github.com/grassroots-project/tasks/issues/1" target="_blank">åœ¨ GitHub ä¸Šç¼–è¾‘äººæ‰åº“</a></p>
  </footer>

  <script>
    function toggleMenu() {
      document.getElementById('nav-menu').classList.toggle('show');
    }

    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    window.addEventListener('scroll', function() {
      const backToTop = document.querySelector('.back-to-top');
      if (window.scrollY > 300) {
        backToTop.classList.remove('hidden');
      } else {
        backToTop.classList.add('hidden');
      }
    });

    const API_BASE = 'https://api.github.com/repos/grassroots-project/tasks';

    // æ•°æ®ç¼“å­˜
    let allIssues = [];
    let allEvents = [];

    // åŠ è½½æ‰€æœ‰æ•°æ®
    async function loadAll() {
      await Promise.all([loadIssues(), loadEvents()]);
      renderStats();
      renderMembers();
      renderActivity();
    }

    // åŠ è½½æ‰€æœ‰ Issues
    async function loadIssues() {
      try {
        const response = await fetch(`${API_BASE}/issues?state=all&per_page=100`, {
          headers: { 'Accept': 'application/vnd.github.v3+json' }
        });
        if (!response.ok) throw new Error('Failed to fetch');
        const issues = await response.json();
        
        // è¿‡æ»¤æ‰ PR å’Œ äººæ‰åº“/èµ„æºæ± 
        allIssues = issues.filter(issue => {
          if (issue.pull_request) return false;
          const labels = issue.labels.map(l => l.name);
          if (labels.includes('äººæ‰åº“') || labels.includes('èµ„æºæ± ')) return false;
          return true;
        });
      } catch (error) {
        console.error('Failed to load issues:', error);
      }
    }

    // åŠ è½½æœ€è¿‘äº‹ä»¶
    async function loadEvents() {
      try {
        const response = await fetch(`${API_BASE}/issues/events?per_page=50`, {
          headers: { 'Accept': 'application/vnd.github.v3+json' }
        });
        if (!response.ok) throw new Error('Failed to fetch');
        allEvents = await response.json();
      } catch (error) {
        console.error('Failed to load events:', error);
        allEvents = [];
      }
    }

    // æ¸²æŸ“ç»Ÿè®¡
    function renderStats() {
      const inProgress = allIssues.filter(i => 
        i.labels.some(l => l.name === 'è¿›è¡Œä¸­')
      ).length;
      
      const completed = allIssues.filter(i => 
        i.labels.some(l => l.name === 'å·²å®Œæˆ') || i.state === 'closed'
      ).length;
      
      const open = allIssues.filter(i => 
        i.state === 'open' && i.labels.some(l => l.name === 'å¾…é¢†')
      ).length;
      
      // è·å–å”¯ä¸€æˆå‘˜æ•°
      const members = new Set();
      allIssues.forEach(issue => {
        issue.assignees.forEach(a => members.add(a.login));
      });
      
      document.getElementById('stat-members').textContent = members.size || 1;
      document.getElementById('stat-in-progress').textContent = inProgress;
      document.getElementById('stat-completed').textContent = completed;
      document.getElementById('stat-open').textContent = open;
    }

    // æ¸²æŸ“æˆå‘˜åˆ—è¡¨
    function renderMembers() {
      const container = document.getElementById('member-list');
      
      // æŒ‰ assignee åˆ†ç»„
      const memberMap = new Map();
      
      allIssues.forEach(issue => {
        const status = getIssueStatus(issue);
        
        issue.assignees.forEach(assignee => {
          if (!memberMap.has(assignee.login)) {
            memberMap.set(assignee.login, {
              login: assignee.login,
              avatar: assignee.avatar_url,
              inProgress: [],
              completed: []
            });
          }
          
          const member = memberMap.get(assignee.login);
          const taskInfo = {
            number: issue.number,
            title: issue.title,
            url: issue.html_url
          };
          
          if (status === 'completed') {
            member.completed.push(taskInfo);
          } else if (status === 'in-progress') {
            member.inProgress.push(taskInfo);
          }
        });
      });
      
      // å¦‚æœæ²¡æœ‰æˆå‘˜ï¼Œæ˜¾ç¤ºé»˜è®¤
      if (memberMap.size === 0) {
        container.innerHTML = `
          <div class="member-card">
            <div class="member-header">
              <div class="member-avatar">T</div>
              <div class="member-info">
                <h3>Tang</h3>
                <div class="join-date">å‘èµ·äºº Â· 2026-02-08</div>
              </div>
            </div>
            <div class="member-tasks">
              <span style="color:#666;font-size:0.9rem;">é¡¹ç›®å‘èµ·ã€æˆ˜ç•¥è§„åˆ’</span>
            </div>
          </div>
        `;
        return;
      }
      
      // æ¸²æŸ“æˆå‘˜å¡ç‰‡
      let html = '';
      memberMap.forEach((member, login) => {
        const initial = login.charAt(0).toUpperCase();
        const totalTasks = member.inProgress.length + member.completed.length;
        
        html += `
          <div class="member-card">
            <div class="member-header">
              <img src="${member.avatar}" alt="${login}" class="member-avatar" style="background:none;">
              <div class="member-info">
                <h3>${login}</h3>
                <div class="join-date">${totalTasks} ä¸ªä»»åŠ¡</div>
              </div>
            </div>
            <div class="member-tasks">
              ${member.inProgress.map(t => `
                <a href="${t.url}" target="_blank" class="task-badge in-progress">
                  ğŸ”„ #${t.number} ${truncate(t.title, 20)}
                </a>
              `).join('')}
              ${member.completed.map(t => `
                <a href="${t.url}" target="_blank" class="task-badge completed">
                  âœ… #${t.number} ${truncate(t.title, 20)}
                </a>
              `).join('')}
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    // æ¸²æŸ“æ´»åŠ¨æµ
    function renderActivity() {
      const container = document.getElementById('activity-feed');
      
      // è¿‡æ»¤æœ‰æ„ä¹‰çš„äº‹ä»¶
      const relevantEvents = allEvents.filter(e => 
        ['assigned', 'labeled', 'closed'].includes(e.event) &&
        e.issue && !e.issue.pull_request
      ).slice(0, 20);
      
      if (relevantEvents.length === 0) {
        container.innerHTML = '<div class="no-activity">æš‚æ— æ´»åŠ¨è®°å½•</div>';
        return;
      }
      
      let html = '';
      relevantEvents.forEach(event => {
        const time = formatTime(event.created_at);
        let icon = '', action = '';
        
        switch (event.event) {
          case 'assigned':
            icon = '<div class="activity-icon claim">ğŸ™‹</div>';
            action = `<span class="actor">${event.actor?.login || 'æœªçŸ¥'}</span> é¢†å–äº† <a href="${event.issue.html_url}" target="_blank" class="task-link">#${event.issue.number} ${truncate(event.issue.title, 25)}</a>`;
            break;
          case 'closed':
            icon = '<div class="activity-icon complete">âœ…</div>';
            action = `<span class="actor">${event.actor?.login || 'æœªçŸ¥'}</span> å®Œæˆäº† <a href="${event.issue.html_url}" target="_blank" class="task-link">#${event.issue.number} ${truncate(event.issue.title, 25)}</a>`;
            break;
          case 'labeled':
            if (event.label?.name === 'è¿›è¡Œä¸­') {
              icon = '<div class="activity-icon claim">ğŸ”„</div>';
              action = `<a href="${event.issue.html_url}" target="_blank" class="task-link">#${event.issue.number}</a> çŠ¶æ€å˜ä¸º <strong>è¿›è¡Œä¸­</strong>`;
            } else if (event.label?.name === 'å·²å®Œæˆ') {
              icon = '<div class="activity-icon complete">ğŸ‰</div>';
              action = `<a href="${event.issue.html_url}" target="_blank" class="task-link">#${event.issue.number}</a> çŠ¶æ€å˜ä¸º <strong>å·²å®Œæˆ</strong>`;
            } else {
              return;
            }
            break;
          default:
            return;
        }
        
        html += `
          <div class="activity-item">
            ${icon}
            <div class="activity-content">
              <div>${action}</div>
              <div class="activity-time">${time}</div>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html || '<div class="no-activity">æš‚æ— æ´»åŠ¨è®°å½•</div>';
    }

    // è¾…åŠ©å‡½æ•°
    function getIssueStatus(issue) {
      if (issue.state === 'closed') return 'completed';
      const labels = issue.labels.map(l => l.name);
      if (labels.includes('å·²å®Œæˆ')) return 'completed';
      if (labels.includes('è¿›è¡Œä¸­')) return 'in-progress';
      return 'open';
    }

    function truncate(str, len) {
      return str.length > len ? str.slice(0, len) + '...' : str;
    }

    function formatTime(isoString) {
      const date = new Date(isoString);
      const now = new Date();
      const diff = now - date;
      
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);
      
      if (minutes < 1) return 'åˆšåˆš';
      if (minutes < 60) return `${minutes} åˆ†é’Ÿå‰`;
      if (hours < 24) return `${hours} å°æ—¶å‰`;
      if (days < 7) return `${days} å¤©å‰`;
      
      return date.toLocaleDateString('zh-CN');
    }

    // åˆå§‹åŒ–
    loadAll();
    
    // æ¯ 30 ç§’è‡ªåŠ¨åˆ·æ–°
    setInterval(loadAll, 30000);
  </script>
</body>
</html>
